<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Disaster Alert System</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 50px; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; }
  </style>
  <!-- Include the Socket.IO client library from a CDN -->
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
  <h1>Disaster Alert System</h1>
  <p>Select the form you wish to fill out:</p>
  <button onclick="window.location.href='/emergency'">Emergency Alert</button>
  <button onclick="window.location.href='/medical'">Medical Alert</button>
  <button onclick="window.location.href='/resource'">Resource Request</button>
  <button onclick="window.location.href='/emergencyMap'">Emergency Map</button>
  
  <!-- Enable Alerts Button -->
  <button id="enableAlertsBtn">Enable Audio Alerts</button>
  
  <!-- Audio element -->
  <audio id="alertSound" src="https://cdn.uppbeat.io/audio-files/917eeef23562404c6620f249596cd4e7/82fdd510eb74db31d8192be992f35033/5032726f7339de39f729eb546e1a92ed/STREAMING-bell-digital-sparkle-swoop-1-00-01.mp3" preload="auto"></audio>
  
  <script>
    // Function to enable audio playback (user must click the button)
    document.getElementById("enableAlertsBtn").addEventListener("click", function() {
      var sound = document.getElementById("alertSound");
      // Attempt to play and immediately pause to satisfy autoplay restrictions.
      sound.play().then(() => {
        sound.pause();
        console.log("Audio alerts enabled.");
      }).catch((error) => {
        console.error("Error enabling audio alerts:", error);
      });
    });
    
    // Connect to the Socket.IO server.
    var socket = io("http://192.168.137.1:8000");
    
    socket.on('connect', () => {
      console.log("PULSE: Connected to backend");
    });
    
    // Listen for crisis_alert events
    socket.on('crisis_alert', (data) => {
      console.log("PULSE: Crisis alert received:", data);
      var sound = document.getElementById("alertSound");
      if (sound) {
        sound.play().catch(error => {
          console.error("Error playing sound:", error);
        });
      }
      alert("PULSE Alert: " + data.message);
    });
    
    socket.on('disconnect', () => {
      console.log("PULSE: Disconnected from backend");
    });
    
    socket.on('error', (error) => {
      console.error("PULSE: Socket error:", error);
    });
  </script>
</body>
</html>
